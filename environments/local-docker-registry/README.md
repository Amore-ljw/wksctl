# Local Docker Registry

This directory contains the resources required to run your own Docker registry.
This can be useful when working offline, when setting up air-gapped cluster, or
just to speed up integration tests, among other scenarii.

## Instructions

1. Install Docker.
2. Start the [Docker registry](https://hub.docker.com/_/registry):

    ```console
    $ docker run -d \
      -p 5000:5000 \
      --restart always \
      -v /tmp/registry:/var/lib/registry \
      --name registry \
      registry:2
    ```

3. Push the container images used by WKS to it:

    ```console
    ./retag_push.sh
    ```

## Future work

Ideally, the `retag_push.sh` script should be automatically generated by WKS
based on the current cluster configuration, e.g. Kubernetes version used in the
machines manifest, `imageRepository` used in the cluster manifest, etc.
WKS v1, which was based on Pharos, had a "retag" feature to do the equivalent
of this script with Pharos' images and their dependencies.
We should implement something similar for WKS v2.
